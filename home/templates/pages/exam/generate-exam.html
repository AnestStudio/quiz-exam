{% extends 'layouts/layout.html' %}
{% load static %}

{% block sub-content %}
  <div class="col-right">
    <div class="generate-exam">
      <!-- Title -->
      <div class="row">
        <div class="col-12">
          <h1 class="title fix-mb-title">Generate exam</h1>
        </div>
      </div>

      <form class="row panel-form mx-0" method="post" action="/exam/generate/view">
        {% csrf_token %}
        <div class="form-group col-12 col-md-8 col-lg-8 flex mb-1 w-100" style="align-items: baseline">
          <fieldset class="bg-dark-ui">
            <legend>Subject</legend>
            <select class="form-control form-select" id="subject" name="subject">
              <option value="0">Select subject</option>
              {% for subject in subjects %}
                <option value="{{ subject.subject_id }}"
                        {% if subject.subject_id == subject_id %}selected{% endif %}>
                  {{ subject.subject_code }} - {{ subject.subject_name }}</option>
              {% endfor %}
            </select>
          </fieldset>
          <button type="submit" class="btn btn-lg btn-secondary">
            <i class="bi bi-search text-success"></i>Search
          </button>
        </div>
      </form>

      <!-- Content -->
      {% if chapters %}
        <form class="row panel-form mx-0" method="post" action="/exam/generate">
          {% csrf_token %}
          <input type="hidden" value="{{ subject_id }}" name="subject_id">
          <div class="form-group col-12 col-md-12 col-lg-6">
            <fieldset>
              <legend>Exam code</legend>
              <input type="text" class="form-control" name="exam_code" placeholder="XXX_XXX_XXX_XXXXXX">
            </fieldset>
          </div>
          <div class="form-group col-12 col-md-12 col-lg-3">
            <fieldset>
              <legend>Exam duration (minus)</legend>
              <input type="text" class="form-control" name="exam_duration" placeholder="90">
            </fieldset>
          </div>
          <div class="form-group col-12 col-md-12 col-lg-3">
            <fieldset>
              <legend>Number of question</legend>
              <input type="text" class="form-control" name="number_question" placeholder="50">
            </fieldset>
          </div>
          <div class="form-group col-12 col-md-12 col-lg-9">
            <fieldset style="height: 380px; overflow: auto">
              <legend>Reselect the question ({{ questions|length }})</legend>
              <div class="custom-radio ps-2" style="display: block">
                {% for question in questions %}
                  <div class="form-check me-3">
                    <input class="form-check-input me-2" type="checkbox" name="question"
                           id="question_{{ forloop.counter }}" value="{{ question.question_id }}">
                    <label class="form-check-label" for="question_{{ forloop.counter }}">
                      <span class="color-tan">[{{ question.unit }}]</span>
                      <span class="text-success d-inline-block text-end" style="width: 30px">[{{ question.question_id }}]</span>&nbsp;
                      {{ question.question }}
                    </label>
                  </div>
                {% endfor %}
              </div>
            </fieldset>
          </div>
          <div class="form-group col-12 col-md-12 col-lg-3">
            <fieldset style="height: 380px; overflow: auto">
              <legend>Chapter</legend>
              <div class="custom-radio ps-2" style="display: block">
                {% for chapter in chapters %}
                  <div class="form-check me-3">
                    <input class="form-check-input me-2" type="checkbox" name="chapter"
                           id="chapter_{{ forloop.counter }}" value="{{ chapter }}">
                    <label class="form-check-label" for="chapter_{{ forloop.counter }}">{{ chapter }}</label>
                  </div>
                {% endfor %}
              </div>
            </fieldset>
          </div>
          <div class="col-md-12 text-end mt-2">
            <a href="javascript:void(0)" class="btn btn-lg btn-secondary me-2">
              <i class="far fa-check-square text-info"></i>Reselect all question
            </a>
            <a href="javascript:void(0)" class="btn btn-lg btn-secondary me-2">
              <i class="far fa-check-square text-info"></i>Select all chapter
            </a>
            <button type="submit" class="btn btn-lg btn-secondary">
              <i class="fas fa-sync text-success"></i>Generate exam
            </button>
          </div>
        </form>
      {% elif chapters == '' %}
        <div class="panel-text py-3" style="height: 316px">
          <div class="row">
            <div class="col-lg-12">Select <span class="color-tan">Subject</span> to generate the exam.</div>
          </div>
        </div>
      {% else %}
        <div class="panel-text py-3" style="height: 316px">
          <div class="row">
            <div class="col-lg-12">No data found.</div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock sub-content %}

{% block javascript %}
  <!-- JavaScript to trigger the toast -->
  <script>
    {% if error_size %}
      document.getElementById('toast-error-content').innerText = 'Số lượng câu hỏi trong danh sách chapter không đủ để tạo đề thi. Vui lòng chọn thêm chapter hoặc câu hỏi.';
      showToast('toast-error');
    {% endif %}
  </script>
{% endblock javascript %}